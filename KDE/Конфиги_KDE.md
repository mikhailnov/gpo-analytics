# Конфигурационные файлы KDE

## О конфигах

KDE использует простые текстовые файлы для хранения настроек. Пример:

```ini
[KDE]
LargeCursor=false
SingleClick=true
[KFileDialog Settings]
Show hidden files=false
Sort by=Name
```

В примере указаны две группы настроек в квадратных скобках. В группах указаны настройки в формате ключ=значение.

## Иерархия конфигурационных файлов

В системе может быть несколько конфигурационных файлов с одним именем и одинаковыми ключами, но разным расположением. Иерархия файлов KDE описана здесь: [https://userbase.kde.org/KDE_System_Administration/KDE_Filesystem_Hierarchy](https://userbase.kde.org/KDE_System_Administration/KDE_Filesystem_Hierarchy). При наличии конфигурационных файлов с одним именем и одинаковыми ключами происходит их комбинирование и использоваться будет тот ключ, который был прочитан из файла в каталоге с большим приоритетом. Конфигурационные файлы из `$KDEHOME` всегда обладают наивысшим приоритетом. В случае, если в одном конфигурационном файле один ключ указан несколько раз, будет использовано последнее его значение.

Схема каскадной конфигурации KDE может использоваться для предоставления пользователям системных или общеорганизационных настроек по умолчанию, при этом позволяя пользователям вносить индивидуальные изменения в эти настройки. KDE не будет записывать данные в файл конфигурации пользователя в `$KDEHOME`, которые соответствуют каким-либо настройкам по умолчанию, заданным таким образом. Настройки для вновь созданных пользователей будут взяты из `/etc/skel`, и изменения в `/etc/skel` будут распространяться только при создании новой учетной записи пользователя.

Используя переменную окружения `$XDG_CONFIG_DIRS`, можно установить свой каталог с системными настройками и изменения производить в нем, не изменяя установленные настройки по умолчанию.

Переменная окружения `$XDG_CONFIG_DIRS` может содержать в себе несколько путей, разделенных двоеточием, как `$PATH`, например:

`/etc/xdg/xxx:/etc/xdg`

Пакет `rosa-xfce-config` устанавливает нестандартное значение этой переменной, можно посмотреть Росу с XFCE в качестве примера.

Осуществляется поиск заданного файла настроек во всех этих каталогах слева направо, а затем в домашнем каталоге — в `~/.config/`. Значения из найденных файлов накладываются как бы справа налево, а затем — из домашнего каталога. Рассмотрим на примере конфигурационного файла файлового менеджера Dolphin — `dolphinrc`:

1) будет найден и прочитан файл /etc/xdg/xxx/dolphinrc (если его нет, то поиск будет продолжен);
2) будет найден и прочитан файл /etc/xdg/dolphinrc;
3) будет найден и прочитан файл ~/.config/dolphinrc.

Сначала будут прогружены настройки из `/etc/xdg/dolphinrc`, затем — из `/etc/xdg/xxx/dolphinrc`. Настройки из `/etc/xdg/xxx/dolphinrc` могут как дополнять, так и перекрывать настройки из `/etc/xdg/dolphinrc`. Затем будут прогружены настройки из `~/.config/dolphinrc`, которые могут перекрывать и/или дополнять все ранее прогруженные настройки.

Аналогично для `$XDG_DATA_DIRS` (`/usr/share`) и `~/.local/share`.

## Использование переменных окружения

В значениях ключей можно использовать переменные окружения, для этого необходимо после имени ключа указать [$e], а в значении имя переменной окружения в фигурных скобках, например:

```ini
[Mail Settings]
Email[$e]=${USER}@${HOST}
```

## Блокировки

Для предотвращения перезаписи более приоритетными настройками в каталоге пользователя системных настроек существует возможность блокировать перезапись системных настроек. Применить блокировку можно для отдельной настройки, группы настроек и всего файла настроек. Для блокировки необходимо разместить `[$i]` перед знаком равенства, для блокировки группы настроек — после имени группы, для блокировки всего файла — в начале файла. Пример:

```ini
[Preview Image]
Caption[$i]=My Caption  #блокировка отдельной настройки
[Mail Settings][$i]  #блокировка группы настроек 
Host[$e]=$(hostname)
Email=waldo@kde.org
```

Стоит отметить, что поведение разных приложений на блокировку может отличаться. Одни приложения могут распознавать блокировку, другие использовать пользовательские настройки, несмотря на наличие блокировки.

Пример, когда блокировки полезны: запретить пользователю отключать блокировку экрана по длительному бездействию в целях соблюдения режима безопасности на предприятии

## kwriteconfig5 и kreadconfig5

Использование встроенной утилиты `kwriteconfig5` для записи в конфигурационные файлы возможно, но только в пользовательские. При попытке записать данные в системные конфигурационные файлы, утилита их записывает в `~/.config/kdeglobals`, даже при установленной переменной `$XDG_CONFIG_DIRS`. Данную утилиту можно использовать для работы с ограничениями пользователя (`~/.config/kdeglobals`).

Утилита может быть полезна для формирования сложных конфигурационных файлов, логику которых сложно реализовать самостоятельно.
